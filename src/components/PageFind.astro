---
import Search from "astro-pagefind/components/Search";
---

<div
  transition:persist
  id="backdrop"
  class="bg-base/85 invisible fixed left-0 top-0 z-50 flex h-screen w-full justify-center p-6 backdrop-blur-sm"
>
  <div
    id="pagefind-container"
    class="m-0 flex h-fit max-h-[80%] w-full max-w-md flex-col overflow-auto rounded-md border border-surface-border bg-base p-4 shadow-2xl"
  >
    <Search
      id="search"
      className="pagefind-ui"
      uiOptions={{
        showImages: false,
        excerptLength: 15,
        resetStyles: false,
      }}
    />
    <div class="pb-1 pt-3 text-right text-xs text-text-muted font-mono">
      <kbd class="px-1 py-0.5 rounded border border-surface-border text-text-muted text-[10px]">esc</kbd> untuk tutup
    </div>
  </div>
</div>

<script is:inline>
  const magnifyingGlass = document.getElementById("magnifying-glass");
  const backdrop = document.getElementById("backdrop");

  function openPagefind() {
    const searchDiv = document.getElementById("search");
    const search = searchDiv.querySelector("input");
    setTimeout(() => {
      search.focus();
    }, 0);
    search.placeholder = "Cari...";
    backdrop?.classList.remove("invisible");
    backdrop?.classList.add("visible");
  }

  function closePagefind() {
    const search = document.getElementById("search");
    search.value = "";
    backdrop?.classList.remove("visible");
    backdrop?.classList.add("invisible");
  }

  magnifyingGlass?.addEventListener("click", () => {
    openPagefind();
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "/") {
      e.preventDefault();
      openPagefind();
    } else if ((e.metaKey || e.ctrlKey) && e.key === "k") {
      e.preventDefault();
      openPagefind();
    }
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" || e.keyCode === 27) {
      closePagefind();
    }
  });

  backdrop?.addEventListener("click", (event) => {
    if (!event.target.closest("#pagefind-container")) {
      closePagefind();
    }
  });

  const form = document.getElementById("form");
  form?.addEventListener("submit", (event) => {
    event.preventDefault();
  });
</script>

<style is:global>
  :root {
    --pagefind-ui-scale: 0.75;
    --pagefind-ui-border-width: 1px;
    --pagefind-ui-border-radius: 6px;
    --pagefind-ui-font: "Geist Mono", monospace;
    --pagefind-ui-primary: #22c55e;
    --pagefind-ui-text: #ededed;
    --pagefind-ui-background: #0a0a0a;
    --pagefind-ui-border: #262626;
    --pagefind-ui-tag: #1e1e1e;
  }

  .dark {
    --pagefind-ui-primary: #22c55e;
    --pagefind-ui-text: #ededed;
    --pagefind-ui-background: #0a0a0a;
    --pagefind-ui-border: #262626;
    --pagefind-ui-tag: #1e1e1e;
  }

  html:not(.dark) {
    --pagefind-ui-primary: #16a34a;
    --pagefind-ui-text: #171717;
    --pagefind-ui-background: #fafafa;
    --pagefind-ui-border: #e5e5e5;
    --pagefind-ui-tag: #f5f5f5;
  }

  #search input {
    font-weight: normal;
    background-color: var(--pagefind-ui-background);
    color: var(--pagefind-ui-text);
    border-color: var(--pagefind-ui-border);
  }

  #search input::placeholder {
    color: var(--pagefind-ui-text);
    opacity: 0.35;
  }

  #search p {
    font-weight: normal;
    color: var(--pagefind-ui-text);
  }

  #search .pagefind-ui__result-title {
    font-weight: 600;
    color: var(--pagefind-ui-text);
  }

  #search .pagefind-ui__result-excerpt {
    color: var(--pagefind-ui-text);
    opacity: 0.7;
  }

  #search .pagefind-ui__message {
    padding: 0;
    padding-bottom: 0.75rem;
    color: var(--pagefind-ui-text);
    opacity: 0.5;
  }

  #search .pagefind-ui__result {
    border-color: var(--pagefind-ui-border);
  }

  #search .pagefind-ui__result:hover {
    background-color: var(--pagefind-ui-tag);
  }
</style>
